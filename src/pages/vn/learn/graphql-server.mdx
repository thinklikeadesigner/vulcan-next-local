import { NextMuiButton } from "@vulcanjs/next-mui";
import { LearnLayout } from "~/learn/components/LearnLayout";
import { StepIfElse } from "~/learn/components/Steps";
import { MultipleChoiceQuestion } from "~/learn/components/MultipleChoiceQuestion";
import { GraphqlQueryEditor } from "~/learn/components/GraphqlQueryEditor";

# Step 5: GraphQL server

## The fastest way toward GraphQL

Vulcan key feature is its ability to create a full-fledged API based on your models.
More precisely, Vulcan relies on [GraphQL](https://graphql.org/), thanks to [Apollo Server](https://www.apollographql.com/docs/apollo-server/).

- You get a single endpoint, `/api/graphql`, to fetch all your data
- You write queries using the GraphQL language

Vulcan generates basic CRUD queries for all your models

- queries to get data (single item or "multi" list). Vulcan's powerful filter system let's you select only the documents you want.
- mutations to manipulate data (create, update, delete).

[Check ðŸ”¥Vulcan Fire documentation for more info.](https://vulcan-docs.vercel.app/docs/vulcan-fire/)

## Merge with a custom schema

In Vulcan Next, you are always allowed to _not_ use Vulcan.
This means that you can also write a custom GraphQL backend using the traditionnal syntax described in Apollo Server documentation.

Open `src/pages/api/graphql.ts`.

In this file, we setup an Apollo GraphQL server. The only specifity, is that we merge the
GraphQL schema with a schema automatically generated by Vulcan.

That's why we want you to always export your server models in `src/core/models.server`, this way relevant resolvers are automatically added
to the GraphQL schema.

## See the schema

Vulcan comes with GraphqQL Playground and GraphQL Voyager installed.

- Open [http://localhost:3000/api/graphql](http://localhost:3000/api/graphql)

- Open [http://localhost:3000/api/debug/graphql-voyager](http://localhost:3000/api/debug/graphql-voyager)

Those awesome tools let you explore your schema and play around with your GraphQL server.

## Go to step 6

### Run the query:

<GraphqlQueryEditor
  initialQuery={`
{
  vulcanUsers {
    results {
      _id
      email
    }
  }
}
`}
/>

### And then answer this question:

<MultipleChoiceQuestion
  question="How many users to you get, as a logged out guest user?"
  answers={[
    "1, the admin that has been seeded on application startup",
    "0, because you are not logged in yet, and the User model permissions disallow reading for anonymouse users",
    "42, because why not",
  ]}
  validAnswerIdx={1}
  ifOk={
    <NextMuiButton variant="contained" href="/learn/final">
      Click to go to next step
    </NextMuiButton>
  }
/>

(Hint: if you open Compass, you should see an admin user in your Mongo database.
But does that mean that you can list users in your Vulcan Next app?)

export default function ServerOnlyModels(props) {
  return <LearnLayout {...props} />;
}
